___TERMS_OF_SERVICE___

By creating or modifying this file you agree to Google Tag Manager's Community
Template Gallery Developer Terms of Service available at
https://developers.google.com/tag-manager/gallery-tos (or such other URL as
Google may provide), as modified from time to time.

___INFO___

{
  "type": "TAG",
  "id": "cvt_temp_public_id",
  "version": 1,
  "securityGroups": [],
  "displayName": "SalesWings Form Submit",
  "categories": ["SALES","PERSONALIZATION","ATTRIBUTION"],
  "brand": {
    "id": "brand_dummy",
    "displayName": "SD Technologies SA",
    "thumbnail": "data:image/png;base64,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"
  },
  "description": "Track form submissions and leverage your leads' digital interactions with your business in a clever way.",
  "containerContexts": [
    "WEB"
  ]
}


___TEMPLATE_PARAMETERS___

[
  {
    "type": "TEXT",
    "name": "emailSelector",
    "displayName": "Email Input Selector",
    "simpleValueType": true,
    "valueValidators": [
      {
        "type": "NON_EMPTY"
      }
    ],
    "help": "CSS selector for the email input field (e.g., \"#email\", \".email-input\", \"input[type='email']\")."
  },
  {
    "type": "GROUP",
    "name": "eventPropertiesGroup",
    "displayName": "Event Property / Lead Attribute Values",
    "groupStyle": "ZIPPY_CLOSED",
    "subParams": [
      {
        "type": "SIMPLE_TABLE",
        "name": "eventProperties",
        "newRowButtonText": "Add",
        "simpleTableColumns": [
          {
            "defaultValue": "",
            "displayName": "ID",
            "name": "id",
            "type": "TEXT",
            "valueValidators": [
              {
                "type": "NON_EMPTY"
              },
              {
                "type": "REGEX",
                "args": [
                  "^[a-zA-Z0-9_]*$"
                ]
              }
            ]
          },
          {
            "defaultValue": "",
            "displayName": "Value",
            "name": "value",
            "type": "TEXT",
            "valueValidators": [
              {
                "type": "NON_EMPTY"
              }
            ]
          }
        ]
      }
    ]
  },
  {
    "type": "GROUP",
    "name": "advancedGroup",
    "displayName": "Advanced",
    "groupStyle": "ZIPPY_CLOSED",
    "subParams": [
      {
        "type": "TEXT",
        "name": "pid",
        "displayName": "Target Project ID",
        "simpleValueType": true,
        "canBeEmptyString": false,
        "help": "Only for domains with multiple SalesWings projects enabled: this field selects the target project for this form submission event. If empty, the event will be sent to all projects. For domains with a single SalesWings project enabled, this field should be left empty."
      }
    ]
  }
]


___SANDBOXED_JS_FOR_WEB_TEMPLATE___

const log = require('logToConsole');
const callInWindow = require('callInWindow');
const queryPermission = require('queryPermission');
const query = require('query');

// Get the email value from the configured selector
let emailValue = '';
if (data.emailSelector) {
  const emailElement = query(data.emailSelector);
  if (emailElement && emailElement.value) {
    emailValue = emailElement.value;
  } else {
    log('Email element not found or has no value for selector: ' + data.emailSelector);
  }
}

// Build the event object
let eventObj = {
  email: emailValue,
  pid: data.pid
};

// Add values object if eventProperties are present
if (data.eventProperties && data.eventProperties.length > 0) {
  eventObj.values = {};
  data.eventProperties.forEach(function(prop) {
    if (prop.id && prop.value) {
      eventObj.values[prop.id] = prop.value;
    }
  });
}

if(!callInWindow('sw','send-form-submit', eventObj)){
  log('Tag not configured properly or script not possible to load');
}

data.gtmOnSuccess();


___WEB_PERMISSIONS___

[
  {
    "instance": {
      "key": {
        "publicId": "logging",
        "versionId": "1"
      },
      "param": [
        {
          "key": "environments",
          "value": {
            "type": 1,
            "string": "all"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "access_globals",
        "versionId": "1"
      },
      "param": [
        {
          "key": "keys",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "sw"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "sw.q"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": false
                  }
                ]
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "access_dom",
        "versionId": "1"
      },
      "param": [
        {
          "key": "allowedDomInteraction",
          "value": {
            "type": 1,
            "string": "specific"
          }
        },
        {
          "key": "allowedDomOperations",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 1,
                "string": "select_elements"
              },
              {
                "type": 1,
                "string": "read_element_properties"
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  }
]


___TESTS___

scenarios:
- name: simple test
  code: |-
    const mockData = {
      pid:'4723ad53-8a19-43ab-9b0a-e6d3f1fbb2e4',
      emailSelector: '#email'
      // Mocked field values
    };

    // Call runCode to run the template's code.
    runCode(mockData);

    // Verify that the tag finished successfully.
    assertApi('gtmOnSuccess').wasCalled();


___NOTES___

Created on 7/9/2025, 12:00:00 PM

